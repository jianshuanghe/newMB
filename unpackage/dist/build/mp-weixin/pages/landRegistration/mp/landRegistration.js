(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/landRegistration/mp/landRegistration"],{"0c24":function(e,n,o){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o={name:"",components:{},data:function(){return{logo:this.Static+"landRegistration/logo.png",phoneIsGet:!0}},created:function(){e.hideShareMenu()},mounted:function(){console.log(this.api2,"全局数据"),this.getSessionKey()},methods:{getSessionKey:function(){var n=this;e.login({provider:"weixin",scopes:"auth_base",success:function(o){console.log(o,"微信返回的code mounted"),e.request({url:n.api2+"/rest-rp/mbUser/wxMiniSessionKey?code="+o.code,data:{},header:{},success:function(n){if(console.log(n.data),"200"===String(n.data.ret)){var o=n.data.content;console.log(o,"sessionKey"),e.setStorageSync("sessionKey",o)}else e.hideLoading(),e.showToast({title:n.data.msg,icon:"none",duration:500})},fail:function(n){e.hideLoading(),e.showToast({title:"网络繁忙，请稍后",icon:"none",duration:1e3}),console.log(n,"网络繁忙，请稍后")}})}})},bindGetUserInfo:function(e){console.log(e)},getPhoneNumber:function(e){if(console.log(e),"getPhoneNumber:fail user deny"==e.detail.errMsg)console.log("用户拒绝提供手机号");else{console.log("用户同意提供手机号");var n=JSON.stringify(e.detail.encryptedData),o=JSON.stringify(e.detail.iv);console.log(n,o,"带你花------------"),this.clickMpLand(n,o)}},clickMpLand:function(n,o){e.showLoading({title:"登陆中···"});var t=this;console.log("触发小程序登录"),wx.checkSession({success:function(){t.mpWxLand(n,o)},fail:function(){console.log("session_key已经过期！"),t.getSessionKey()}})},mpWxLand:function(n,o){console.log("微信小程序登录"),e.showLoading({title:"登陆中···"});var t=this;e.getUserInfo({provider:"weixin",success:function(a){console.log(a,"拉取到的用户信息");var i=e.getStorageSync("sessionKey"),s={sessionKey:i,nickname:a.userInfo.nickName,compLogo:a.userInfo.avatarUrl,signature:a.signature,rawData:a.rawData,phoneEncryptedData:JSON.parse(n),phoneIv:JSON.parse(o),userEncryptedData:a.encryptedData,userIv:a.iv};e.request({url:t.api2+"/rest-rp/mbUser/wxMiniLogin",data:s,method:"POST",header:{},success:function(n){if(console.log(n.data),"200"===String(n.data.ret)){var o={randomKey:n.data.content.randomKey,token:n.data.content.token,user:{id:n.data.content.userId}};e.setStorageSync("landRegist",JSON.stringify(o)),t.getUserData()}else"400"===String(n.data.ret)?(e.hideLoading(),t.phoneIsGet=!1,e.showToast({title:"请同意获取手机号注册，再登录！",icon:"none",duration:500})):"500"===String(n.data.ret)?(e.hideLoading(),console.log(n.data,"---------------------response.data---------------------"),console.log("------------------------5000-----------------------"),e.showToast({title:"网络开小差了，请再次点击登录！",icon:"none",duration:500})):(e.hideLoading(),e.showToast({title:n.data.msg,icon:"none",duration:500}))},fail:function(n){e.hideLoading(),e.showToast({title:"网络繁忙，请稍后",icon:"none",duration:1e3}),console.log(n,"网络繁忙，请稍后")}})}})},mpTtLand:function(){console.log("头条小程序登录")},mpBdLand:function(){console.log("百度小程序登录")},mpApLand:function(){console.log("支付宝小程序登录")},getUserData:function(){console.log("获取用户信息，全部");var n=JSON.parse(e.getStorageSync("landRegist"));console.log(n.user.id),e.request({url:this.api2+"/rest-rp/user/"+n.user.id,data:{},header:{Authorization:"Bearer "+n.token},success:function(n){if(console.log(n.data),"200"===String(n.data.ret)){var o=n.data.content;e.setStorageSync("UserData",JSON.stringify(o)),e.showToast({title:"登陆成功",icon:"none",duration:500}),e.navigateBack({delta:1}),setTimeout(function(){e.reLaunch({url:"/pages/mbc/home"})},500)}else e.hideLoading(),e.showToast({title:n.data.msg,icon:"none",duration:500})},fail:function(n){e.hideLoading(),e.showToast({title:"网络繁忙，请稍后",icon:"none",duration:1e3}),console.log(n,"网络繁忙，请稍后")}})}}};n.default=o}).call(this,o("543d")["default"])},"211f":function(e,n,o){"use strict";var t=o("d4af"),a=o.n(t);a.a},"48ca":function(e,n,o){"use strict";o.r(n);var t=o("a0f6"),a=o("7354");for(var i in a)"default"!==i&&function(e){o.d(n,e,function(){return a[e]})}(i);o("211f");var s=o("2877"),r=Object(s["a"])(a["default"],t["a"],t["b"],!1,null,"42334d38",null);n["default"]=r.exports},7354:function(e,n,o){"use strict";o.r(n);var t=o("0c24"),a=o.n(t);for(var i in t)"default"!==i&&function(e){o.d(n,e,function(){return t[e]})}(i);n["default"]=a.a},a0f6:function(e,n,o){"use strict";var t=function(){var e=this,n=e.$createElement;e._self._c},a=[];o.d(n,"a",function(){return t}),o.d(n,"b",function(){return a})},d4af:function(e,n,o){}},[["004b","common/runtime","common/vendor"]]]);