(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/landRegistration/mp/landRegistration"],{"0c24":function(e,o,n){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n={name:"",components:{},data:function(){return{logo:this.Static+"landRegistration/logo.png",phoneIsGet:!0}},created:function(){},mounted:function(){console.log(this.api2,"全局数据"),this.getSessionKey()},methods:{getSessionKey:function(){var o=this;e.login({provider:"weixin",scopes:"auth_base",success:function(n){console.log(n,"微信返回的code mounted"),e.request({url:o.api2+"/rest-rp/mbUser/baiduMiniSessionKey?code="+n.code,data:{},header:{},success:function(o){if(console.log(o.data),"200"===String(o.data.ret)){var n=o.data.content;console.log(n,"sessionKey"),e.setStorageSync("sessionKey",n)}else e.hideLoading(),e.showToast({title:o.data.msg,icon:"none",duration:500})},fail:function(o){e.hideLoading(),e.showToast({title:"网络繁忙，请稍后",icon:"none",duration:1e3}),console.log(o,"网络繁忙，请稍后")}})}})},bindGetUserInfo:function(e){console.log(e)},getPhoneNumber:function(e){if(console.log(e),"getPhoneNumber:fail user deny"==e.detail.errMsg)console.log("用户拒绝提供手机号");else{console.log("用户同意提供手机号"),console.log(e);var o=JSON.stringify(e.detail.encryptedData),n=JSON.stringify(e.detail.iv);console.log(o,n,"带你花------------11"),this.clickMpLand(o,n)}},clickMpLand:function(o,n){e.showLoading({title:"登陆中···"});var t=this;console.log("触发小程序登录"),e.checkSession({success:function(){t.mpBDLand(o,n)},fail:function(){console.log("session_key已经过期！"),t.getSessionKey()}})},mpBDLand:function(o,n){console.log("百度小程序登录"),e.showLoading({title:"登陆中···"});var t=this;e.getUserInfo({success:function(n){console.log(n,"拉取到的用户信息");var a=e.getStorageSync("sessionKey");console.log(a);var i={openId:a.openid,baiduUserEncryptedData:n.data,sessionKey:a.session_key,baiduPhoneEncryptedData:JSON.parse(o)};console.log(i,"-------------------------------------------"),e.request({url:t.api2+"/rest-rp/mbUser/baiduMiniLogin",data:i,method:"POST",header:{},success:function(o){if(console.log(o.data),"200"===String(o.data.ret)){var n={randomKey:o.data.content.randomKey,token:o.data.content.token,user:{id:o.data.content.userId}};e.setStorageSync("landRegist",JSON.stringify(n)),t.getUserData()}else"400"===String(o.data.ret)?(e.hideLoading(),t.phoneIsGet=!1,e.showToast({title:"请同意获取手机号注册，再登录！",icon:"none",duration:500})):"500"===String(o.data.ret)?(e.hideLoading(),console.log(o.data,"---------------------response.data---------------------"),console.log("------------------------5000-----------------------"),e.showToast({title:"网络开小差了，请再次点击登录！",icon:"none",duration:500})):(e.hideLoading(),e.showToast({title:o.data.msg,icon:"none",duration:500}))},fail:function(o){e.hideLoading(),e.showToast({title:"网络繁忙，请稍后",icon:"none",duration:1e3}),console.log(o,"网络繁忙，请稍后")}})}})},mpWxLand:function(o,n){console.log("微信小程序登录"),e.showLoading({title:"登陆中···"});var t=this;e.getUserInfo({provider:"weixin",success:function(a){console.log(a,"拉取到的用户信息");var i=e.getStorageSync("sessionKey"),s={sessionKey:i,nickname:a.userInfo.nickName,compLogo:a.userInfo.avatarUrl,signature:a.signature,rawData:a.rawData,phoneEncryptedData:JSON.parse(o),phoneIv:JSON.parse(n),userEncryptedData:a.encryptedData,userIv:a.iv};e.request({url:t.api2+"/rest-rp/mbUser/wxMiniLogin",data:s,method:"POST",header:{},success:function(o){if(console.log(o.data),"200"===String(o.data.ret)){var n={randomKey:o.data.content.randomKey,token:o.data.content.token,user:{id:o.data.content.userId}};e.setStorageSync("landRegist",JSON.stringify(n)),t.getUserData()}else"400"===String(o.data.ret)?(e.hideLoading(),t.phoneIsGet=!1,e.showToast({title:"请同意获取手机号注册，再登录！",icon:"none",duration:500})):"500"===String(o.data.ret)?(e.hideLoading(),console.log(o.data,"---------------------response.data---------------------"),console.log("------------------------5000-----------------------"),e.showToast({title:"网络开小差了，请再次点击登录！",icon:"none",duration:500})):(e.hideLoading(),e.showToast({title:o.data.msg,icon:"none",duration:500}))},fail:function(o){e.hideLoading(),e.showToast({title:"网络繁忙，请稍后",icon:"none",duration:1e3}),console.log(o,"网络繁忙，请稍后")}})}})},mpTtLand:function(){console.log("头条小程序登录")},mpBdLand:function(){console.log("百度小程序登录")},mpApLand:function(){console.log("支付宝小程序登录")},getUserData:function(){console.log("获取用户信息，全部");var o=JSON.parse(e.getStorageSync("landRegist"));console.log(o.user.id),e.request({url:this.api2+"/rest-rp/user/"+o.user.id,data:{},header:{Authorization:"Bearer "+o.token},success:function(o){if(console.log(o.data),"200"===String(o.data.ret)){var n=o.data.content;e.setStorageSync("UserData",JSON.stringify(n)),e.showToast({title:"登陆成功",icon:"none",duration:500}),e.navigateBack({delta:1}),setTimeout(function(){e.reLaunch({url:"/pages/mbc/home"})},500)}else e.hideLoading(),e.showToast({title:o.data.msg,icon:"none",duration:500})},fail:function(o){e.hideLoading(),e.showToast({title:"网络繁忙，请稍后",icon:"none",duration:1e3}),console.log(o,"网络繁忙，请稍后")}})}}};o.default=n}).call(this,n("5486")["default"])},"211a":function(e,o,n){"use strict";var t=function(){var e=this,o=e.$createElement;e._self._c},a=[];n.d(o,"a",function(){return t}),n.d(o,"b",function(){return a})},"48ca":function(e,o,n){"use strict";n.r(o);var t=n("211a"),a=n("7354");for(var i in a)"default"!==i&&function(e){n.d(o,e,function(){return a[e]})}(i);n("7432");var s=n("2877"),r=Object(s["a"])(a["default"],t["a"],t["b"],!1,null,"95dd4844",null);o["default"]=r.exports},7354:function(e,o,n){"use strict";n.r(o);var t=n("0c24"),a=n.n(t);for(var i in t)"default"!==i&&function(e){n.d(o,e,function(){return t[e]})}(i);o["default"]=a.a},7432:function(e,o,n){"use strict";var t=n("90c7"),a=n.n(t);a.a},"90c7":function(e,o,n){}},[["004b","common/runtime","common/vendor"]]]);